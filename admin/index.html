<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflorist Driver Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-red: #EF3E62;
            --primary-purple: #7E33C8;
            --dark-gray: #404040;
            --medium-gray: #565656;
            --light-gray: #F1F5F5;
            --input-gray: #9A9EA6;
            --error-red: #E20000;
            --success-green: #38AF4B;
            --warning-orange: #F5A623;
            --blue: #3B82F6;
            --white: #FFFFFF;
            --sidebar-w: 260px;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Poppins',sans-serif; background:var(--light-gray); color:var(--dark-gray); min-height:100vh; }

        /* ===== LOGIN ===== */
        .login-overlay { position:fixed; inset:0; background:linear-gradient(135deg,var(--primary-red),#d4345a,var(--primary-purple)); display:flex; justify-content:center; align-items:center; z-index:9999; transition:opacity .5s; }
        .login-overlay.hidden { opacity:0; pointer-events:none; }
        .login-box { background:var(--white); border-radius:24px; padding:48px 40px; width:420px; max-width:90%; box-shadow:0 20px 60px rgba(0,0,0,.3); text-align:center; }
        .login-logo { width:80px; height:80px; background:var(--primary-red); border-radius:20px; margin:0 auto 24px; display:flex; justify-content:center; align-items:center; font-size:32px; color:#fff; }
        .login-title { font-size:24px; font-weight:700; color:var(--primary-red); text-transform:uppercase; margin-bottom:4px; }
        .login-sub { font-size:14px; color:var(--input-gray); margin-bottom:32px; }
        .login-form .fg { margin-bottom:20px; text-align:left; }
        .login-form .fl { font-size:12px; font-weight:500; color:var(--dark-gray); text-transform:uppercase; margin-bottom:8px; display:block; }
        .login-form .fi { width:100%; height:48px; border:1px solid #E8ECF0; border-radius:12px; padding:0 16px; font-family:'Poppins',sans-serif; font-size:14px; color:var(--dark-gray); background:#F8F9FA; transition:all .3s; }
        .login-form .fi:focus { outline:none; border-color:var(--primary-red); box-shadow:0 0 0 3px rgba(239,62,98,.15); background:#fff; }
        .login-btn { width:100%; height:50px; background:var(--primary-red); color:#fff; border:none; border-radius:40px; font-family:'Poppins',sans-serif; font-size:16px; font-weight:600; text-transform:uppercase; cursor:pointer; transition:all .2s; letter-spacing:1px; }
        .login-btn:hover { transform:translateY(-2px); box-shadow:0 8px 25px rgba(239,62,98,.4); }
        .login-btn:disabled { opacity:.6; cursor:not-allowed; transform:none; }
        .login-err { color:var(--error-red); font-size:12px; margin-top:8px; display:none; }
        .login-err.show { display:block; }

        /* ===== SIDEBAR ===== */
        .sidebar { position:fixed; top:0; left:0; width:var(--sidebar-w); height:100vh; background:linear-gradient(180deg,var(--primary-red),#d4345a); z-index:1000; overflow-y:auto; transition:transform .3s; }
        .sb-head { padding:24px 20px; border-bottom:1px solid rgba(255,255,255,.15); text-align:center; }
        .sb-logo { width:50px; height:50px; background:rgba(255,255,255,.2); border-radius:14px; margin:0 auto 12px; display:flex; justify-content:center; align-items:center; font-size:22px; }
        .sb-brand { font-size:18px; font-weight:700; color:#fff; text-transform:uppercase; }
        .sb-brand-sub { font-size:11px; color:rgba(255,255,255,.7); text-transform:uppercase; letter-spacing:1px; }
        .sb-nav { padding:16px 0; }
        .sb-sec { font-size:10px; font-weight:600; color:rgba(255,255,255,.5); text-transform:uppercase; letter-spacing:1.5px; padding:8px 24px; margin-top:8px; }
        .sb-link { display:flex; align-items:center; padding:12px 24px; color:rgba(255,255,255,.8); text-decoration:none; font-size:14px; font-weight:500; transition:all .2s; cursor:pointer; border-left:3px solid transparent; }
        .sb-link:hover { background:rgba(255,255,255,.1); color:#fff; }
        .sb-link.active { background:rgba(255,255,255,.15); color:#fff; border-left-color:#fff; }
        .sb-link i { width:22px; margin-right:14px; text-align:center; font-size:16px; }
        .sb-link .badge { margin-left:auto; background:#fff; color:var(--primary-red); font-size:10px; font-weight:700; padding:2px 8px; border-radius:10px; }
        .sb-footer { padding:16px 20px; border-top:1px solid rgba(255,255,255,.15); }
        .sb-user { display:flex; align-items:center; padding:10px; border-radius:12px; background:rgba(255,255,255,.1); }
        .sb-user-av { width:36px; height:36px; border-radius:10px; background:rgba(255,255,255,.2); display:flex; justify-content:center; align-items:center; margin-right:10px; font-size:14px; font-weight:700; color:#fff; }
        .sb-user-name { font-size:13px; font-weight:600; color:#fff; }
        .sb-user-role { font-size:10px; color:rgba(255,255,255,.6); text-transform:uppercase; }

        /* ===== MAIN ===== */
        .main { margin-left:var(--sidebar-w); min-height:100vh; }
        .topbar { background:#fff; padding:16px 30px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #E8ECF0; position:sticky; top:0; z-index:100; }
        .topbar-left { display:flex; align-items:center; gap:16px; }
        .topbar-ham { display:none; background:none; border:none; font-size:22px; color:var(--dark-gray); cursor:pointer; }
        .topbar-title { font-size:20px; font-weight:600; color:var(--dark-gray); }
        .topbar-sub { font-size:12px; color:var(--input-gray); }
        .topbar-right { display:flex; align-items:center; gap:12px; }
        .topbar-search { position:relative; }
        .topbar-search input { width:260px; height:40px; border:1px solid #E8ECF0; border-radius:20px; padding:0 16px 0 40px; font-family:'Poppins',sans-serif; font-size:13px; color:var(--dark-gray); background:var(--light-gray); transition:all .3s; }
        .topbar-search input:focus { outline:none; border-color:var(--primary-red); background:#fff; }
        .topbar-search i { position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--input-gray); font-size:14px; }
        .topbar-icon { width:40px; height:40px; border-radius:12px; border:none; background:var(--light-gray); cursor:pointer; display:flex; justify-content:center; align-items:center; position:relative; font-size:16px; color:var(--medium-gray); transition:background .2s; }
        .topbar-icon:hover { background:#E8ECF0; }
        .topbar-icon .nd { position:absolute; top:8px; right:8px; width:8px; height:8px; border-radius:4px; background:var(--primary-red); }
        .topbar-logout { height:40px; padding:0 20px; border-radius:20px; border:2px solid var(--primary-red); background:transparent; color:var(--primary-red); font-family:'Poppins',sans-serif; font-size:13px; font-weight:600; cursor:pointer; text-transform:uppercase; transition:all .2s; }
        .topbar-logout:hover { background:var(--primary-red); color:#fff; }

        /* ===== PAGE ===== */
        .page-content { padding:30px; }
        .page-sec { display:none; }
        .page-sec.active { display:block; }

        /* ===== STATS ===== */
        .stats-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:20px; margin-bottom:30px; }
        .stat-card { background:#fff; border-radius:16px; padding:24px; box-shadow:0 2px 8px rgba(0,0,0,.06); transition:all .2s; }
        .stat-card:hover { transform:translateY(-4px); box-shadow:0 8px 25px rgba(0,0,0,.1); }
        .stat-hdr { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
        .stat-icon { width:48px; height:48px; border-radius:12px; display:flex; justify-content:center; align-items:center; font-size:20px; }
        .stat-change { font-size:12px; font-weight:600; padding:4px 10px; border-radius:20px; }
        .stat-change.up { color:var(--success-green); background:rgba(56,175,75,.1); }
        .stat-val { font-size:32px; font-weight:700; color:var(--dark-gray); margin-bottom:4px; }
        .stat-label { font-size:13px; color:var(--input-gray); text-transform:uppercase; letter-spacing:.5px; }

        /* ===== CARDS ===== */
        .card { background:#fff; border-radius:16px; box-shadow:0 2px 8px rgba(0,0,0,.06); margin-bottom:24px; }
        .card-hdr { display:flex; justify-content:space-between; align-items:center; padding:20px 24px; border-bottom:1px solid #F1F5F5; }
        .card-title { font-size:16px; font-weight:600; color:var(--dark-gray); text-transform:uppercase; }
        .card-body { padding:24px; }

        /* ===== BUTTONS ===== */
        .btn { height:40px; padding:0 20px; border-radius:10px; font-family:'Poppins',sans-serif; font-size:13px; font-weight:600; text-transform:uppercase; cursor:pointer; transition:all .2s; border:none; display:inline-flex; align-items:center; gap:8px; }
        .btn-primary { background:var(--primary-red); color:#fff; }
        .btn-primary:hover { background:#d4345a; box-shadow:0 4px 15px rgba(239,62,98,.3); }
        .btn-secondary { background:var(--light-gray); color:var(--dark-gray); }
        .btn-secondary:hover { background:#E8ECF0; }
        .btn-success { background:var(--success-green); color:#fff; }
        .btn-success:hover { background:#2d9640; }
        .btn-danger { background:var(--error-red); color:#fff; }
        .btn-danger:hover { background:#c50000; }
        .btn-outline { background:transparent; border:2px solid var(--primary-red); color:var(--primary-red); }
        .btn-outline:hover { background:var(--primary-red); color:#fff; }
        .btn-sm { height:32px; padding:0 14px; font-size:11px; border-radius:8px; }

        /* ===== TABLE ===== */
        .tbl-wrap { overflow-x:auto; }
        table { width:100%; border-collapse:collapse; }
        th { text-align:left; padding:14px 16px; font-size:11px; font-weight:600; color:var(--input-gray); text-transform:uppercase; letter-spacing:.5px; background:#FAFBFC; border-bottom:2px solid #F1F5F5; }
        td { padding:14px 16px; font-size:13px; color:var(--dark-gray); border-bottom:1px solid #F1F5F5; vertical-align:middle; }
        tr:hover td { background:#FAFBFC; }
        .tbl-av { width:36px; height:36px; border-radius:10px; background:var(--primary-red); color:#fff; display:inline-flex; justify-content:center; align-items:center; font-size:13px; font-weight:700; margin-right:10px; vertical-align:middle; }
        .tbl-name { font-weight:600; }
        .tbl-email { font-size:11px; color:var(--input-gray); }

        /* ===== STATUS ===== */
        .status { display:inline-flex; align-items:center; padding:4px 12px; border-radius:20px; font-size:11px; font-weight:600; text-transform:uppercase; gap:6px; }
        .status .dot { width:6px; height:6px; border-radius:3px; }
        .s-active { background:rgba(56,175,75,.1); color:var(--success-green); }
        .s-active .dot { background:var(--success-green); }
        .s-pending { background:rgba(245,166,35,.1); color:var(--warning-orange); }
        .s-pending .dot { background:var(--warning-orange); }
        .s-suspended { background:rgba(226,0,0,.1); color:var(--error-red); }
        .s-suspended .dot { background:var(--error-red); }
        .s-inactive { background:rgba(154,158,166,.1); color:var(--input-gray); }
        .s-inactive .dot { background:var(--input-gray); }
        .s-delivered { background:rgba(56,175,75,.1); color:var(--success-green); }
        .s-delivered .dot { background:var(--success-green); }
        .s-in_transit,.s-picked_up { background:rgba(59,130,246,.1); color:var(--blue); }
        .s-in_transit .dot,.s-picked_up .dot { background:var(--blue); }
        .s-assigned,.s-accepted { background:rgba(126,51,200,.1); color:var(--primary-purple); }
        .s-assigned .dot,.s-accepted .dot { background:var(--primary-purple); }
        .s-cancelled { background:rgba(226,0,0,.1); color:var(--error-red); }
        .s-cancelled .dot { background:var(--error-red); }

        .dt-badge { display:inline-flex; padding:3px 10px; border-radius:6px; font-size:10px; font-weight:600; text-transform:uppercase; }
        .dt-permanent { background:rgba(126,51,200,.1); color:var(--primary-purple); }
        .dt-old { background:rgba(59,130,246,.1); color:var(--blue); }
        .dt-temporary { background:rgba(245,166,35,.1); color:var(--warning-orange); }

        /* ===== GRIDS ===== */
        .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:24px; }
        .grid-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:24px; }

        /* ===== FORM ===== */
        .form-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px; }
        .fg { margin-bottom:16px; }
        .fl { display:block; font-size:12px; font-weight:500; color:var(--dark-gray); text-transform:uppercase; margin-bottom:8px; }
        .fi,.fs,.ft { width:100%; height:44px; border:1px solid #E8ECF0; border-radius:10px; padding:0 14px; font-family:'Poppins',sans-serif; font-size:13px; color:var(--dark-gray); background:#F8F9FA; transition:all .2s; }
        .ft { height:100px; padding:12px 14px; resize:vertical; }
        .fi:focus,.fs:focus,.ft:focus { outline:none; border-color:var(--primary-red); box-shadow:0 0 0 3px rgba(239,62,98,.1); background:#fff; }
        .fs { cursor:pointer; appearance:none; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239A9EA6' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 14px center; padding-right:40px; }

        /* ===== MODAL ===== */
        .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; justify-content:center; align-items:center; z-index:2000; }
        .modal-overlay.show { display:flex; }
        .modal { background:#fff; border-radius:20px; width:560px; max-width:90%; max-height:90vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,.2); }
        .modal-hdr { display:flex; justify-content:space-between; align-items:center; padding:24px; border-bottom:1px solid #F1F5F5; }
        .modal-title { font-size:18px; font-weight:600; color:var(--dark-gray); text-transform:uppercase; }
        .modal-close { width:36px; height:36px; border-radius:10px; border:none; background:var(--light-gray); cursor:pointer; font-size:18px; color:var(--medium-gray); display:flex; justify-content:center; align-items:center; }
        .modal-close:hover { background:#E8ECF0; }
        .modal-body { padding:24px; }
        .modal-ftr { padding:16px 24px; border-top:1px solid #F1F5F5; display:flex; justify-content:flex-end; gap:10px; }

        /* ===== ACTIVATION ===== */
        .act-panel { background:#fff; border-radius:16px; padding:24px; margin-bottom:24px; box-shadow:0 2px 8px rgba(0,0,0,.06); display:flex; justify-content:space-between; align-items:center; }
        .act-info h3 { font-size:16px; font-weight:600; margin-bottom:4px; }
        .act-info p { font-size:13px; color:var(--input-gray); }
        .toggle { position:relative; width:56px; height:30px; cursor:pointer; }
        .toggle input { opacity:0; width:0; height:0; }
        .toggle-sl { position:absolute; inset:0; background:#E0E0E0; border-radius:15px; transition:background .3s; }
        .toggle-sl:before { content:''; position:absolute; width:24px; height:24px; border-radius:12px; background:#fff; top:3px; left:3px; transition:transform .3s; box-shadow:0 2px 4px rgba(0,0,0,.2); }
        .toggle input:checked+.toggle-sl { background:var(--success-green); }
        .toggle input:checked+.toggle-sl:before { transform:translateX(26px); }

        /* ===== EARNINGS ===== */
        .earn-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-bottom:24px; }
        .earn-card { background:#fff; border-radius:12px; padding:20px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,.06); }
        .earn-val { font-size:28px; font-weight:700; color:var(--dark-gray); margin-bottom:4px; }
        .earn-label { font-size:12px; font-weight:500; color:var(--input-gray); text-transform:uppercase; }

        /* ===== MAP ===== */
        .map-box { height:400px; background:#E8ECEC; border-radius:16px; display:flex; justify-content:center; align-items:center; overflow:hidden; }
        .map-box iframe { width:100%; height:100%; border:none; border-radius:16px; }
        .map-ph { text-align:center; color:var(--input-gray); }
        .map-ph i { font-size:48px; margin-bottom:12px; }

        /* ===== CHART PLACEHOLDER ===== */
        .chart-ph { height:280px; background:linear-gradient(135deg,#FAFBFC,#F1F5F5); border-radius:12px; display:flex; justify-content:center; align-items:center; flex-direction:column; color:var(--input-gray); }
        .chart-ph i { font-size:48px; margin-bottom:12px; opacity:.4; }

        /* ===== ONLINE DOT ===== */
        .on-dot { width:10px; height:10px; border-radius:5px; display:inline-block; margin-right:6px; }
        .on-dot.on { background:var(--success-green); box-shadow:0 0 6px rgba(56,175,75,.5); animation:pulse 2s infinite; }
        .on-dot.off { background:var(--input-gray); }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }

        /* ===== PAGINATION ===== */
        .pag { display:flex; justify-content:space-between; align-items:center; padding:16px 24px; border-top:1px solid #F1F5F5; }
        .pag-info { font-size:13px; color:var(--input-gray); }

        /* ===== TOAST ===== */
        .toast-box { position:fixed; top:20px; right:20px; z-index:5000; display:flex; flex-direction:column; gap:10px; }
        .toast { background:#fff; border-radius:12px; padding:14px 20px; box-shadow:0 8px 30px rgba(0,0,0,.15); display:flex; align-items:center; gap:12px; min-width:320px; animation:slideIn .4s ease; border-left:4px solid; }
        .toast.success { border-left-color:var(--success-green); }
        .toast.error { border-left-color:var(--error-red); }
        .toast.warning { border-left-color:var(--warning-orange); }
        .toast.info { border-left-color:var(--blue); }
        .toast-msg { flex:1; font-size:13px; font-weight:500; color:var(--dark-gray); }
        .toast-x { background:none; border:none; font-size:16px; color:var(--input-gray); cursor:pointer; }
        @keyframes slideIn { from{transform:translateX(100%);opacity:0} to{transform:translateX(0);opacity:1} }

        /* ===== EMPTY ===== */
        .empty { text-align:center; padding:60px 20px; color:var(--input-gray); }
        .empty i { font-size:56px; margin-bottom:16px; opacity:.3; }
        .empty h3 { font-size:18px; font-weight:600; color:var(--dark-gray); margin-bottom:8px; }

        /* ===== RESPONSIVE ===== */
        @media(max-width:1200px) { .stats-grid{grid-template-columns:repeat(2,1fr);} }
        @media(max-width:768px) {
            .sidebar{transform:translateX(-100%);} .sidebar.open{transform:translateX(0);}
            .main{margin-left:0;} .topbar-ham{display:block;} .topbar-search{display:none;}
            .stats-grid,.grid-2,.grid-3,.form-row,.earn-grid{grid-template-columns:1fr;}
        }
    </style>
</head>
<body>
    <!-- LOGIN -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <div class="login-logo"><i class="fas fa-truck"></i></div>
            <h1 class="login-title">Netflorist</h1>
            <p class="login-sub">Driver Management Admin Panel</p>
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="fg"><label class="fl">Email</label><input type="email" class="fi" id="loginEmail" placeholder="admin@netflorist.co.za" required></div>
                <div class="fg"><label class="fl">Password</label><input type="password" class="fi" id="loginPass" placeholder="Enter password" required></div>
                <div class="login-err" id="loginErr">Invalid email or password</div>
                <button type="submit" class="login-btn" id="loginBtn">Sign In</button>
            </form>
        </div>
    </div>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sb-head">
            <div class="sb-logo">ðŸŒ¸</div>
            <div class="sb-brand">Netflorist</div>
            <div class="sb-brand-sub">Driver Admin</div>
        </div>
        <nav class="sb-nav">
            <div class="sb-sec">Main</div>
            <a class="sb-link active" data-page="dashboard" onclick="go('dashboard')"><i class="fas fa-th-large"></i>Dashboard</a>
            <a class="sb-link" data-page="drivers" onclick="go('drivers')"><i class="fas fa-users"></i>Drivers<span class="badge" id="pendBadge">0</span></a>
            <a class="sb-link" data-page="deliveries" onclick="go('deliveries')"><i class="fas fa-box"></i>Deliveries</a>
            <a class="sb-link" data-page="loads" onclick="go('loads')"><i class="fas fa-plus-circle"></i>Create Load</a>
            <div class="sb-sec">Management</div>
            <a class="sb-link" data-page="earnings" onclick="go('earnings')"><i class="fas fa-wallet"></i>Earnings</a>
            <a class="sb-link" data-page="tracking" onclick="go('tracking')"><i class="fas fa-map-marker-alt"></i>Live Tracking</a>
            <a class="sb-link" data-page="temporary" onclick="go('temporary')"><i class="fas fa-user-clock"></i>Temp Drivers</a>
            <a class="sb-link" data-page="notifications" onclick="go('notifications')"><i class="fas fa-bell"></i>Notifications</a>
            <div class="sb-sec">Settings</div>
            <a class="sb-link" data-page="settings" onclick="go('settings')"><i class="fas fa-cog"></i>Settings</a>
        </nav>
        <div class="sb-footer"><div class="sb-user"><div class="sb-user-av">A</div><div><div class="sb-user-name">Admin</div><div class="sb-user-role">Administrator</div></div></div></div>
    </aside>

    <!-- MAIN -->
    <div class="main" id="mainContent">
        <div class="topbar">
            <div class="topbar-left">
                <button class="topbar-ham" onclick="document.getElementById('sidebar').classList.toggle('open')"><i class="fas fa-bars"></i></button>
                <div><div class="topbar-title" id="pgTitle">Dashboard</div><div class="topbar-sub" id="pgSub">Overview of your delivery operations</div></div>
            </div>
            <div class="topbar-right">
                <div class="topbar-search"><i class="fas fa-search"></i><input type="text" placeholder="Search drivers, orders..." id="gSearch"></div>
                <button class="topbar-icon" onclick="go('notifications')"><i class="fas fa-bell"></i><span class="nd" id="notifDot"></span></button>
                <button class="topbar-logout" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>

        <div class="page-content">
            <!-- DASHBOARD -->
            <div class="page-sec active" id="pg-dashboard">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-hdr"><div class="stat-icon" style="background:rgba(56,175,75,.1);color:#38AF4B"><i class="fas fa-signal"></i></div><span class="stat-change up">Live</span></div><div class="stat-val" id="sOnline">0</div><div class="stat-label">Online Drivers</div></div>
                    <div class="stat-card"><div class="stat-hdr"><div class="stat-icon" style="background:rgba(59,130,246,.1);color:#3B82F6"><i class="fas fa-shipping-fast"></i></div><span class="stat-change up">Active</span></div><div class="stat-val" id="sActive">0</div><div class="stat-label">Active Deliveries</div></div>
                    <div class="stat-card"><div class="stat-hdr"><div class="stat-icon" style="background:rgba(239,62,98,.1);color:#EF3E62"><i class="fas fa-check-circle"></i></div><span class="stat-change up">Today</span></div><div class="stat-val" id="sCompleted">0</div><div class="stat-label">Completed Today</div></div>
                    <div class="stat-card"><div class="stat-hdr"><div class="stat-icon" style="background:rgba(126,51,200,.1);color:#7E33C8"><i class="fas fa-coins"></i></div><span class="stat-change up">Today</span></div><div class="stat-val" id="sEarnings">R0</div><div class="stat-label">Today's Earnings</div></div>
                </div>
                <div class="grid-2">
                    <div class="card"><div class="card-hdr"><span class="card-title">Recent Deliveries</span><button class="btn btn-sm btn-secondary" onclick="go('deliveries')">View All</button></div><div class="card-body"><div class="tbl-wrap"><table><thead><tr><th>Order</th><th>Driver</th><th>Status</th><th>Amount</th></tr></thead><tbody id="recentDel"><tr><td colspan="4" style="text-align:center;color:#9A9EA6;padding:30px">Loading...</td></tr></tbody></table></div></div></div>
                    <div class="card"><div class="card-hdr"><span class="card-title">Pending Approvals</span><button class="btn btn-sm btn-primary" onclick="go('drivers')">Manage</button></div><div class="card-body"><div class="tbl-wrap"><table><thead><tr><th>Driver</th><th>Type</th><th>Applied</th><th>Actions</th></tr></thead><tbody id="pendApprovals"><tr><td colspan="4" style="text-align:center;color:#9A9EA6;padding:30px">Loading...</td></tr></tbody></table></div></div></div>
                </div>
                <div class="card"><div class="card-hdr"><span class="card-title">Delivery Trends (Last 7 Days)</span></div><div class="card-body"><div class="chart-ph"><i class="fas fa-chart-line"></i><p>Chart visualization â€” integrate Chart.js for live data</p></div></div></div>
            </div>

            <!-- DRIVERS -->
            <div class="page-sec" id="pg-drivers">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
                    <div style="display:flex;gap:8px"><button class="btn btn-secondary btn-sm df active" data-f="all" onclick="fDrv('all',this)">All</button><button class="btn btn-secondary btn-sm df" data-f="active" onclick="fDrv('active',this)">Active</button><button class="btn btn-secondary btn-sm df" data-f="pending" onclick="fDrv('pending',this)">Pending</button><button class="btn btn-secondary btn-sm df" data-f="suspended" onclick="fDrv('suspended',this)">Suspended</button></div>
                    <button class="btn btn-primary" onclick="openAddDriver()"><i class="fas fa-plus"></i> Add Driver</button>
                </div>
                <div class="card"><div class="card-body" style="padding:0"><div class="tbl-wrap"><table><thead><tr><th>Driver</th><th>Phone</th><th>Type</th><th>Status</th><th>Online</th><th>Deliveries</th><th>Rating</th><th>Actions</th></tr></thead><tbody id="drvTbl"><tr><td colspan="8" class="empty"><p>Loading...</p></td></tr></tbody></table></div><div class="pag"><div class="pag-info" id="drvPag">Showing 0</div><div></div></div></div></div>
            </div>

            <!-- DELIVERIES -->
            <div class="page-sec" id="pg-deliveries">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
                    <div style="display:flex;gap:8px"><button class="btn btn-secondary btn-sm dlf active" data-f="all" onclick="fDel('all',this)">All</button><button class="btn btn-secondary btn-sm dlf" data-f="pending" onclick="fDel('pending',this)">Pending</button><button class="btn btn-secondary btn-sm dlf" data-f="assigned" onclick="fDel('assigned',this)">Assigned</button><button class="btn btn-secondary btn-sm dlf" data-f="in_transit" onclick="fDel('in_transit',this)">In Transit</button><button class="btn btn-secondary btn-sm dlf" data-f="delivered" onclick="fDel('delivered',this)">Delivered</button></div>
                    <button class="btn btn-primary" onclick="go('loads')"><i class="fas fa-plus"></i> Create Delivery</button>
                </div>
                <div class="card"><div class="card-body" style="padding:0"><div class="tbl-wrap"><table><thead><tr><th>Order</th><th>Customer</th><th>Driver</th><th>Pickup</th><th>Drop-off</th><th>Items</th><th>Status</th><th>Fee</th><th>Actions</th></tr></thead><tbody id="delTbl"><tr><td colspan="9" class="empty"><p>Loading...</p></td></tr></tbody></table></div><div class="pag"><div class="pag-info" id="delPag">Showing 0</div><div></div></div></div></div>
            </div>

            <!-- CREATE LOAD -->
            <div class="page-sec" id="pg-loads">
                <div class="grid-2">
                    <div class="card"><div class="card-hdr"><span class="card-title">Create New Delivery</span></div><div class="card-body">
                        <form id="loadForm" onsubmit="createLoad(event)">
                            <div class="fg"><label class="fl">Order ID</label><input type="text" class="fi" id="lOrd" placeholder="ORD-XXXX" required></div>
                            <div class="form-row"><div class="fg"><label class="fl">Customer Name</label><input type="text" class="fi" id="lCName" required></div><div class="fg"><label class="fl">Customer Phone</label><input type="tel" class="fi" id="lCPhone" required></div></div>
                            <div class="fg"><label class="fl">Pickup Address</label><input type="text" class="fi" id="lPickup" required></div>
                            <div class="fg"><label class="fl">Delivery Address</label><input type="text" class="fi" id="lDropoff" required></div>
                            <div class="form-row"><div class="fg"><label class="fl">Number of Items</label><input type="number" class="fi" id="lItems" min="1" value="1" required></div><div class="fg"><label class="fl">Delivery Value (R)</label><input type="number" class="fi" id="lVal" step="0.01" min="0" placeholder="0.00"></div></div>
                            <div class="form-row"><div class="fg"><label class="fl">Assign Driver</label><select class="fs" id="lDriver"><option value="">Auto-assign (nearest)</option></select></div><div class="fg"><label class="fl">Scheduled Time</label><input type="datetime-local" class="fi" id="lSched"></div></div>
                            <div class="fg"><label class="fl">Notes</label><textarea class="ft" id="lNotes" placeholder="Special instructions..."></textarea></div>
                            <div style="display:flex;gap:10px;margin-top:8px"><button type="submit" class="btn btn-primary" style="flex:1"><i class="fas fa-paper-plane"></i> Create</button><button type="reset" class="btn btn-secondary">Reset</button></div>
                        </form>
                    </div></div>
                    <div>
                        <div class="card"><div class="card-hdr"><span class="card-title">Earnings Calculator</span></div><div class="card-body">
                            <div class="fg"><label class="fl">Driver Type</label><select class="fs" id="cType" onchange="calc()"><option value="permanent">Permanent</option><option value="old">Old</option><option value="temporary">Temporary</option></select></div>
                            <div class="form-row"><div class="fg"><label class="fl">Items</label><input type="number" class="fi" id="cItems" min="1" value="1" oninput="calc()"></div><div class="fg"><label class="fl">Value (R)</label><input type="number" class="fi" id="cVal" step="0.01" value="500" oninput="calc()"></div></div>
                            <div style="background:var(--light-gray);border-radius:12px;padding:20px;margin-top:12px">
                                <div style="display:flex;justify-content:space-between;margin-bottom:10px"><span style="font-size:13px;color:var(--input-gray)">Units:</span><span style="font-size:13px;font-weight:600" id="cUnits">1</span></div>
                                <div style="display:flex;justify-content:space-between;margin-bottom:10px"><span style="font-size:13px;color:var(--input-gray)">Rate:</span><span style="font-size:13px;font-weight:600" id="cRate">5% commission</span></div>
                                <div style="border-top:1px solid #E8ECF0;padding-top:12px;display:flex;justify-content:space-between"><span style="font-size:16px;font-weight:600">Earnings:</span><span style="font-size:20px;font-weight:700;color:var(--primary-red)" id="cEarn">R25.00</span></div>
                            </div>
                        </div></div>
                        <div class="card"><div class="card-hdr"><span class="card-title">Rate Table</span></div><div class="card-body"><table><thead><tr><th>Type</th><th>Rate</th><th>Formula</th></tr></thead><tbody>
                            <tr><td><span class="dt-badge dt-permanent">Permanent</span></td><td>5%</td><td style="font-size:11px">value Ã— 0.05</td></tr>
                            <tr><td><span class="dt-badge dt-old">Old</span></td><td>R30/unit</td><td style="font-size:11px">ceil(items/2) Ã— R30</td></tr>
                            <tr><td><span class="dt-badge dt-temporary">Temporary</span></td><td>R50/unit</td><td style="font-size:11px">ceil(items/2) Ã— R50</td></tr>
                        </tbody></table></div></div>
                    </div>
                </div>
            </div>

            <!-- EARNINGS -->
            <div class="page-sec" id="pg-earnings">
                <div class="earn-grid">
                    <div class="earn-card"><div class="earn-val" id="eTotal">R0</div><div class="earn-label">Total (This Month)</div></div>
                    <div class="earn-card"><div class="earn-val" id="ePaid">R0</div><div class="earn-label">Paid Out</div></div>
                    <div class="earn-card"><div class="earn-val" id="ePending">R0</div><div class="earn-label">Pending</div></div>
                </div>
                <div class="card"><div class="card-hdr"><span class="card-title">Driver Earnings</span><button class="btn btn-sm btn-outline" onclick="toast('info','CSV export coming soon')"><i class="fas fa-download"></i> Export</button></div><div class="card-body" style="padding:0"><div class="tbl-wrap"><table><thead><tr><th>Driver</th><th>Type</th><th>Deliveries</th><th>Units</th><th>Value</th><th>Earnings</th><th>Status</th></tr></thead><tbody id="earnTbl"><tr><td colspan="7" class="empty"><p>Loading...</p></td></tr></tbody></table></div></div></div>
            </div>

            <!-- TRACKING -->
            <div class="page-sec" id="pg-tracking">
                <div class="grid-2" style="grid-template-columns:2fr 1fr">
                    <div class="card"><div class="card-hdr"><span class="card-title">Live Map</span><button class="btn btn-sm btn-secondary" onclick="loadTracking();toast('info','Refreshed')"><i class="fas fa-sync-alt"></i> Refresh</button></div><div class="card-body" style="padding:0"><div class="map-box" id="liveMap"><div class="map-ph"><i class="fas fa-map-marked-alt"></i><p>Integrate Leaflet.js or Google Maps API here</p></div></div></div></div>
                    <div><div class="card"><div class="card-hdr"><span class="card-title">Online Drivers</span></div><div class="card-body" id="onlineList" style="max-height:500px;overflow-y:auto"><p style="color:var(--input-gray);text-align:center;font-size:13px">Loading...</p></div></div></div>
                </div>
            </div>

            <!-- TEMP DRIVERS -->
            <div class="page-sec" id="pg-temporary">
                <div class="act-panel">
                    <div class="act-info"><h3>Temporary Driver Activation</h3><p>Enable/disable temporary driver hiring for peak seasons</p></div>
                    <div style="display:flex;align-items:center;gap:12px">
                        <span id="actStatus" style="font-size:13px;font-weight:600;color:var(--error-red)">INACTIVE</span>
                        <label class="toggle"><input type="checkbox" id="tempToggle" onchange="toggleTemp(this.checked)"><span class="toggle-sl"></span></label>
                    </div>
                </div>
                <div class="card"><div class="card-hdr"><span class="card-title">Temporary Drivers</span></div><div class="card-body" style="padding:0"><div class="tbl-wrap"><table><thead><tr><th>Driver</th><th>Phone</th><th>Area</th><th>Status</th><th>Online</th><th>Deliveries</th><th>Earnings</th><th>Actions</th></tr></thead><tbody id="tempTbl"><tr><td colspan="8" class="empty"><p>Loading...</p></td></tr></tbody></table></div></div></div>
            </div>

            <!-- NOTIFICATIONS -->
            <div class="page-sec" id="pg-notifications">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px"><h3 style="font-size:16px;font-weight:600">Send Notifications</h3><button class="btn btn-primary" onclick="openModal('notifModal')"><i class="fas fa-paper-plane"></i> Send New</button></div>
                <div class="card"><div class="card-hdr"><span class="card-title">History</span></div><div class="card-body" style="padding:0"><div class="tbl-wrap"><table><thead><tr><th>Type</th><th>Title</th><th>Message</th><th>Sent To</th><th>Date</th></tr></thead><tbody id="notifHist"><tr><td colspan="5" class="empty"><p>No notifications sent yet</p></td></tr></tbody></table></div></div></div>
            </div>

            <!-- SETTINGS -->
            <div class="page-sec" id="pg-settings">
                <div class="grid-2">
                    <div class="card"><div class="card-hdr"><span class="card-title">General Settings</span></div><div class="card-body">
                        <div class="fg"><label class="fl">Company Name</label><input type="text" class="fi" value="Netflorist" readonly></div>
                        <div class="fg"><label class="fl">Support Phone</label><input type="text" class="fi" value="087 240 1200"></div>
                        <div class="fg"><label class="fl">Support Email</label><input type="email" class="fi" value="support@netflorist.co.za"></div>
                        <div class="fg"><label class="fl">GPS Update Interval (sec)</label><input type="number" class="fi" value="30" min="10" max="120"></div>
                        <button class="btn btn-primary" style="margin-top:8px" onclick="toast('success','Settings saved!')"><i class="fas fa-save"></i> Save</button>
                    </div></div>
                    <div class="card"><div class="card-hdr"><span class="card-title">Earnings Rates</span></div><div class="card-body">
                        <div class="fg"><label class="fl">Permanent Commission (%)</label><input type="number" class="fi" value="5" min="0" max="100" step="0.5"></div>
                        <div class="fg"><label class="fl">Old Driver Rate/Unit (R)</label><input type="number" class="fi" value="30" min="0" step="5"></div>
                        <div class="fg"><label class="fl">Temporary Rate/Unit (R)</label><input type="number" class="fi" value="50" min="0" step="5"></div>
                        <div class="fg"><label class="fl">Items Per Unit</label><input type="number" class="fi" value="2" min="1" max="10"></div>
                        <button class="btn btn-primary" style="margin-top:8px" onclick="toast('success','Rates updated!')"><i class="fas fa-save"></i> Save Rates</button>
                    </div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- DRIVER MODAL -->
    <div class="modal-overlay" id="drvModal">
        <div class="modal"><div class="modal-hdr"><span class="modal-title" id="drvModalTitle">Add Driver</span><button class="modal-close" onclick="closeModal('drvModal')">&times;</button></div>
        <div class="modal-body"><form id="drvForm" onsubmit="saveDriver(event)">
            <input type="hidden" id="drvEditId">
            <div class="form-row"><div class="fg"><label class="fl">Full Name *</label><input type="text" class="fi" id="drvName" required></div><div class="fg"><label class="fl">Email *</label><input type="email" class="fi" id="drvEmail" required></div></div>
            <div class="form-row"><div class="fg"><label class="fl">Phone *</label><input type="tel" class="fi" id="drvPhone" required></div><div class="fg"><label class="fl">License *</label><input type="text" class="fi" id="drvLic" required></div></div>
            <div class="form-row"><div class="fg"><label class="fl">Driver Type *</label><select class="fs" id="drvType" required><option value="permanent">Permanent</option><option value="old">Old</option><option value="temporary">Temporary</option></select></div><div class="fg"><label class="fl">Vehicle *</label><select class="fs" id="drvVeh" required><option value="Car">Car</option><option value="Motorcycle">Motorcycle</option><option value="Van">Van</option><option value="Bakkie">Bakkie</option><option value="Truck">Truck</option><option value="Bicycle">Bicycle</option></select></div></div>
            <div class="form-row"><div class="fg"><label class="fl">Area</label><input type="text" class="fi" id="drvArea"></div><div class="fg"><label class="fl">Status</label><select class="fs" id="drvStatus"><option value="pending">Pending</option><option value="active">Active</option><option value="inactive">Inactive</option><option value="suspended">Suspended</option></select></div></div>
            <div class="fg" id="drvPassGrp"><label class="fl">Password * (new drivers)</label><input type="password" class="fi" id="drvPass" minlength="6" placeholder="Min 6 chars"></div>
        </form></div>
        <div class="modal-ftr"><button class="btn btn-secondary" onclick="closeModal('drvModal')">Cancel</button><button class="btn btn-primary" onclick="document.getElementById('drvForm').requestSubmit()"><i class="fas fa-save"></i> Save</button></div></div>
    </div>

    <!-- NOTIFICATION MODAL -->
    <div class="modal-overlay" id="notifModal">
        <div class="modal"><div class="modal-hdr"><span class="modal-title">Send Notification</span><button class="modal-close" onclick="closeModal('notifModal')">&times;</button></div>
        <div class="modal-body"><form id="notifForm" onsubmit="sendNotif(event)">
            <div class="fg"><label class="fl">Send To</label><select class="fs" id="nTarget"><option value="all">All Drivers</option><option value="permanent">Permanent</option><option value="old">Old</option><option value="temporary">Temporary</option><option value="online">Online Only</option></select></div>
            <div class="fg"><label class="fl">Type</label><select class="fs" id="nType"><option value="system">System</option><option value="activation">Activation</option><option value="warning">Warning</option><option value="earnings">Earnings</option></select></div>
            <div class="fg"><label class="fl">Title *</label><input type="text" class="fi" id="nTitle" required></div>
            <div class="fg"><label class="fl">Message *</label><textarea class="ft" id="nMsg" required></textarea></div>
        </form></div>
        <div class="modal-ftr"><button class="btn btn-secondary" onclick="closeModal('notifModal')">Cancel</button><button class="btn btn-primary" onclick="document.getElementById('notifForm').requestSubmit()"><i class="fas fa-paper-plane"></i> Send</button></div></div>
    </div>

    <div class="toast-box" id="toastBox"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    const SB_URL='https://xaikxueachrjydabuueb.supabase.co';
    const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhaWt4dWVhY2hyanlkYWJ1dWViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMzkyNjUsImV4cCI6MjA4NjgxNTI2NX0.OmdiEby0PMJ6Bdnk22ilg2VvysfU7SE9JduIJ8gdKQk';
    const sb=window.supabase.createClient(SB_URL,SB_KEY);
    let sess=null,allDrv=[],allDel=[],drvFilter='all',delFilter='all';

    // AUTH
    async function handleLogin(e){e.preventDefault();const em=document.getElementById('loginEmail').value,pw=document.getElementById('loginPass').value,btn=document.getElementById('loginBtn'),err=document.getElementById('loginErr');btn.disabled=true;btn.textContent='Signing in...';err.classList.remove('show');try{const{data,error}=await sb.auth.signInWithPassword({email:em,password:pw});if(error)throw error;sess=data.session;document.getElementById('loginOverlay').classList.add('hidden');initDash();toast('success','Welcome back, Admin!');}catch(er){err.textContent=er.message||'Invalid credentials';err.classList.add('show');}finally{btn.disabled=false;btn.textContent='Sign In';}}
    async function doLogout(){if(confirm('Log out?')){await sb.auth.signOut();sess=null;document.getElementById('loginOverlay').classList.remove('hidden');toast('info','Logged out');}}
    async function checkSess(){const{data:{session}}=await sb.auth.getSession();if(session){sess=session;document.getElementById('loginOverlay').classList.add('hidden');initDash();}}

    // NAV
    function go(p){document.querySelectorAll('.page-sec').forEach(s=>s.classList.remove('active'));document.querySelectorAll('.sb-link').forEach(l=>l.classList.remove('active'));const sec=document.getElementById('pg-'+p),link=document.querySelector(`.sb-link[data-page="${p}"]`);if(sec)sec.classList.add('active');if(link)link.classList.add('active');const t={dashboard:['Dashboard','Overview of operations'],drivers:['Drivers','Manage all drivers'],deliveries:['Deliveries','Track deliveries'],loads:['Create Load','New delivery order'],earnings:['Earnings','Payouts & earnings'],tracking:['Live Tracking','Real-time locations'],temporary:['Temp Drivers','Seasonal workforce'],notifications:['Notifications','Send & manage'],settings:['Settings','Configuration']};const[ti,su]=t[p]||['',''];document.getElementById('pgTitle').textContent=ti;document.getElementById('pgSub').textContent=su;if(p==='drivers')loadDrivers();if(p==='deliveries')loadDeliveries();if(p==='earnings')loadEarnings();if(p==='tracking')loadTracking();if(p==='temporary')loadTemp();if(p==='loads')loadDrvOpts();}

    // DASH
    async function initDash(){await Promise.all([loadStats(),loadRecent(),loadPending()]);}
    async function loadStats(){try{const{data:on}=await sb.from('drivers').select('id').eq('online_status','online');document.getElementById('sOnline').textContent=on?.length||0;const{data:act}=await sb.from('deliveries').select('id').in('status',['assigned','in_transit','picked_up','accepted']);document.getElementById('sActive').textContent=act?.length||0;const td=new Date();td.setHours(0,0,0,0);const{data:comp}=await sb.from('deliveries').select('id,delivery_fee').eq('status','delivered').gte('delivered_time',td.toISOString());document.getElementById('sCompleted').textContent=comp?.length||0;const tot=(comp||[]).reduce((s,d)=>s+(d.delivery_fee||0),0);document.getElementById('sEarnings').textContent='R'+tot.toFixed(0);}catch(e){console.error(e);}}
    async function loadRecent(){try{const{data}=await sb.from('deliveries').select('*,drivers(full_name)').order('created_at',{ascending:false}).limit(5);const tb=document.getElementById('recentDel');if(!data?.length){tb.innerHTML='<tr><td colspan="4" style="text-align:center;color:#9A9EA6;padding:30px">No deliveries yet</td></tr>';return;}tb.innerHTML=data.map(d=>`<tr><td style="font-weight:600">${d.order_id||'N/A'}</td><td>${d.drivers?.full_name||'Unassigned'}</td><td><span class="status s-${d.status}"><span class="dot"></span>${d.status}</span></td><td style="font-weight:600">R${(d.delivery_fee||0).toFixed(2)}</td></tr>`).join('');}catch(e){console.error(e);}}
    async function loadPending(){try{const{data}=await sb.from('drivers').select('*').eq('status','pending').order('created_at',{ascending:false}).limit(5);document.getElementById('pendBadge').textContent=data?.length||0;const tb=document.getElementById('pendApprovals');if(!data?.length){tb.innerHTML='<tr><td colspan="4" style="text-align:center;color:#9A9EA6;padding:30px">No pending</td></tr>';return;}tb.innerHTML=data.map(d=>`<tr><td><span class="tbl-av">${(d.full_name||'?')[0].toUpperCase()}</span><span class="tbl-name">${d.full_name}</span></td><td><span class="dt-badge dt-${d.driver_type||'permanent'}">${d.driver_type||'permanent'}</span></td><td>${new Date(d.created_at).toLocaleDateString('en-ZA')}</td><td><button class="btn btn-sm btn-success" onclick="approve('${d.id}')"><i class="fas fa-check"></i></button> <button class="btn btn-sm btn-danger" onclick="reject('${d.id}')"><i class="fas fa-times"></i></button></td></tr>`).join('');}catch(e){console.error(e);}}

    // DRIVERS
    async function loadDrivers(){try{const{data,error}=await sb.from('drivers').select('*').order('created_at',{ascending:false});if(error)throw error;allDrv=data||[];renderDrv();}catch(e){console.error(e);}}
    function renderDrv(){let f=allDrv;if(drvFilter!=='all')f=allDrv.filter(d=>d.status===drvFilter);const tb=document.getElementById('drvTbl');document.getElementById('drvPag').textContent=`Showing ${f.length} driver${f.length!==1?'s':''}`;if(!f.length){tb.innerHTML='<tr><td colspan="8" class="empty"><i class="fas fa-users"></i><h3>No Drivers</h3></td></tr>';return;}tb.innerHTML=f.map(d=>`<tr><td><span class="tbl-av">${(d.full_name||'?')[0].toUpperCase()}</span><div style="display:inline-block;vertical-align:middle"><div class="tbl-name">${d.full_name}</div><div class="tbl-email">${d.license_number||''}</div></div></td><td>${d.phone||''}</td><td><span class="dt-badge dt-${d.driver_type||'permanent'}">${d.driver_type||'permanent'}</span></td><td><span class="status s-${d.status}"><span class="dot"></span>${d.status}</span></td><td><span class="on-dot ${d.online_status==='online'?'on':'off'}"></span>${d.online_status||'offline'}</td><td style="font-weight:600">${d.total_deliveries||0}</td><td>â­ ${(d.rating||0).toFixed(1)}</td><td><button class="btn btn-sm btn-secondary" onclick="editDrv('${d.id}')"><i class="fas fa-edit"></i></button> ${d.status==='pending'?`<button class="btn btn-sm btn-success" onclick="approve('${d.id}')"><i class="fas fa-check"></i></button>`:''}${d.status==='active'?`<button class="btn btn-sm btn-danger" onclick="suspend('${d.id}')"><i class="fas fa-ban"></i></button>`:''}${d.status==='suspended'?`<button class="btn btn-sm btn-success" onclick="reactivate('${d.id}')"><i class="fas fa-undo"></i></button>`:''}</td></tr>`).join('');}
    function fDrv(f,btn){drvFilter=f;document.querySelectorAll('.df').forEach(b=>b.classList.remove('active'));if(btn)btn.classList.add('active');renderDrv();}
    function openAddDriver(){document.getElementById('drvModalTitle').textContent='Add Driver';document.getElementById('drvForm').reset();document.getElementById('drvEditId').value='';document.getElementById('drvPassGrp').style.display='block';openModal('drvModal');}
    function editDrv(id){const d=allDrv.find(x=>x.id===id);if(!d)return;document.getElementById('drvModalTitle').textContent='Edit Driver';document.getElementById('drvEditId').value=id;document.getElementById('drvName').value=d.full_name||'';document.getElementById('drvEmail').value='';document.getElementById('drvPhone').value=d.phone||'';document.getElementById('drvLic').value=d.license_number||'';document.getElementById('drvType').value=d.driver_type||'permanent';document.getElementById('drvVeh').value=d.vehicle_type||'Car';document.getElementById('drvArea').value=d.residential_area||'';document.getElementById('drvStatus').value=d.status||'pending';document.getElementById('drvPassGrp').style.display='none';openModal('drvModal');}
    async function saveDriver(e){e.preventDefault();const eid=document.getElementById('drvEditId').value;if(eid){try{const{error}=await sb.from('drivers').update({full_name:document.getElementById('drvName').value,phone:document.getElementById('drvPhone').value,license_number:document.getElementById('drvLic').value,driver_type:document.getElementById('drvType').value,vehicle_type:document.getElementById('drvVeh').value,residential_area:document.getElementById('drvArea').value,status:document.getElementById('drvStatus').value,updated_at:new Date().toISOString()}).eq('id',eid);if(error)throw error;toast('success','Driver updated!');closeModal('drvModal');loadDrivers();loadStats();}catch(er){toast('error',er.message);}}else{const em=document.getElementById('drvEmail').value,pw=document.getElementById('drvPass').value;if(!em||!pw||pw.length<6){toast('error','Email & password (min 6) required');return;}try{const{data:au,error:ae}=await sb.auth.signUp({email:em,password:pw,options:{data:{full_name:document.getElementById('drvName').value}}});if(ae)throw ae;const{error:pe}=await sb.from('drivers').insert({user_id:au.user.id,full_name:document.getElementById('drvName').value,email:em,phone:document.getElementById('drvPhone').value,license_number:document.getElementById('drvLic').value,driver_type:document.getElementById('drvType').value,vehicle_type:document.getElementById('drvVeh').value,residential_area:document.getElementById('drvArea').value,status:document.getElementById('drvStatus').value});if(pe)throw pe;toast('success','Driver created!');closeModal('drvModal');loadDrivers();loadPending();}catch(er){toast('error',er.message);}}}
    async function approve(id){if(!confirm('Approve?'))return;try{await sb.from('drivers').update({status:'active',updated_at:new Date().toISOString()}).eq('id',id);toast('success','Approved!');loadDrivers();loadPending();loadStats();}catch(e){toast('error',e.message);}}
    async function reject(id){if(!confirm('Reject?'))return;try{await sb.from('drivers').update({status:'suspended',updated_at:new Date().toISOString()}).eq('id',id);toast('warning','Rejected');loadDrivers();loadPending();}catch(e){toast('error',e.message);}}
    async function suspend(id){if(!confirm('Suspend?'))return;try{await sb.from('drivers').update({status:'suspended',online_status:'offline',updated_at:new Date().toISOString()}).eq('id',id);toast('warning','Suspended');loadDrivers();loadStats();}catch(e){toast('error',e.message);}}
    async function reactivate(id){if(!confirm('Reactivate?'))return;try{await sb.from('drivers').update({status:'active',updated_at:new Date().toISOString()}).eq('id',id);toast('success','Reactivated');loadDrivers();loadStats();}catch(e){toast('error',e.message);}}

    // DELIVERIES
    async function loadDeliveries(){try{const{data,error}=await sb.from('deliveries').select('*,drivers(full_name,driver_type)').order('created_at',{ascending:false});if(error)throw error;allDel=data||[];renderDel();}catch(e){console.error(e);}}
    function renderDel(){let f=allDel;if(delFilter!=='all')f=allDel.filter(d=>d.status===delFilter);const tb=document.getElementById('delTbl');document.getElementById('delPag').textContent=`Showing ${f.length} deliver${f.length!==1?'ies':'y'}`;if(!f.length){tb.innerHTML='<tr><td colspan="9" class="empty"><i class="fas fa-box-open"></i><h3>No Deliveries</h3></td></tr>';return;}tb.innerHTML=f.map(d=>`<tr><td style="font-weight:600">${d.order_id||'N/A'}</td><td><div>${d.customer_name||'N/A'}</div><div class="tbl-email">${d.customer_phone||''}</div></td><td>${d.drivers?.full_name||'<span style="color:#9A9EA6">Unassigned</span>'}</td><td style="max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${d.pickup_address||''}">${d.pickup_address||'N/A'}</td><td style="max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${d.delivery_address||''}">${d.delivery_address||'N/A'}</td><td>${d.items_count||0}</td><td><span class="status s-${d.status}"><span class="dot"></span>${d.status}</span></td><td style="font-weight:600">R${(d.delivery_fee||0).toFixed(2)}</td><td>${d.status==='pending'?`<button class="btn btn-sm btn-success" onclick="updDel('${d.id}','assigned')"><i class="fas fa-user-check"></i></button>`:''}<button class="btn btn-sm btn-secondary" onclick="viewDel('${d.id}')"><i class="fas fa-eye"></i></button></td></tr>`).join('');}
    function fDel(f,btn){delFilter=f;document.querySelectorAll('.dlf').forEach(b=>b.classList.remove('active'));if(btn)btn.classList.add('active');renderDel();}
    async function updDel(id,st){try{const u={status:st,updated_at:new Date().toISOString()};if(st==='in_transit')u.picked_up_time=new Date().toISOString();if(st==='delivered')u.delivered_time=new Date().toISOString();await sb.from('deliveries').update(u).eq('id',id);toast('success',`Status â†’ ${st}`);loadDeliveries();loadStats();}catch(e){toast('error',e.message);}}
    function viewDel(id){const d=allDel.find(x=>x.id===id);if(!d)return;alert(`Order: ${d.order_id}\nCustomer: ${d.customer_name}\nPhone: ${d.customer_phone}\nPickup: ${d.pickup_address}\nDrop-off: ${d.delivery_address}\nItems: ${d.items_count}\nStatus: ${d.status}\nFee: R${(d.delivery_fee||0).toFixed(2)}\nNotes: ${d.notes||'None'}`);}

    // LOADS
    async function loadDrvOpts(){try{const{data}=await sb.from('drivers').select('id,full_name,driver_type').eq('status','active').order('full_name');const sel=document.getElementById('lDriver');sel.innerHTML='<option value="">Auto-assign</option>';(data||[]).forEach(d=>{sel.innerHTML+=`<option value="${d.id}">${d.full_name} (${d.driver_type||'perm'})</option>`;});}catch(e){console.error(e);}}
    async function createLoad(e){e.preventDefault();const items=parseInt(document.getElementById('lItems').value),did=document.getElementById('lDriver').value||null,val=parseFloat(document.getElementById('lVal').value)||0;let fee=0,units=Math.ceil(items/2);if(did){const drv=allDrv.find(d=>d.id===did);if(drv){const dt=drv.driver_type||'permanent';if(dt==='permanent')fee=val*0.05;else if(dt==='old')fee=units*30;else fee=units*50;}}try{await sb.from('deliveries').insert({order_id:document.getElementById('lOrd').value,customer_name:document.getElementById('lCName').value,customer_phone:document.getElementById('lCPhone').value,pickup_address:document.getElementById('lPickup').value,delivery_address:document.getElementById('lDropoff').value,items_count:items,grouped_units:units,delivery_value:val,delivery_fee:fee,driver_id:did,status:did?'assigned':'pending',notes:document.getElementById('lNotes').value,scheduled_time:document.getElementById('lSched').value||null});toast('success','Delivery created!');document.getElementById('loadForm').reset();loadStats();}catch(e){toast('error',e.message);}}

    // CALC
    function calc(){const t=document.getElementById('cType').value,i=parseInt(document.getElementById('cItems').value)||1,v=parseFloat(document.getElementById('cVal').value)||0,u=Math.ceil(i/2);let e=0,r='';if(t==='permanent'){e=v*0.05;r='5% commission';}else if(t==='old'){e=u*30;r='R30/unit';}else{e=u*50;r='R50/unit';}document.getElementById('cUnits').textContent=u;document.getElementById('cRate').textContent=r;document.getElementById('cEarn').textContent='R'+e.toFixed(2);}

    // EARNINGS
    async function loadEarnings(){try{const{data}=await sb.from('deliveries').select('*,drivers(full_name,driver_type)').eq('status','delivered').order('delivered_time',{ascending:false});const del=data||[],tot=del.reduce((s,d)=>s+(d.delivery_fee||0),0);document.getElementById('eTotal').textContent='R'+tot.toFixed(2);document.getElementById('ePaid').textContent='R'+(tot*.8).toFixed(2);document.getElementById('ePending').textContent='R'+(tot*.2).toFixed(2);const grp={};del.forEach(d=>{const k=d.driver_id||'na';if(!grp[k])grp[k]={name:d.drivers?.full_name||'Unassigned',type:d.drivers?.driver_type||'permanent',del:0,units:0,val:0,earn:0};grp[k].del++;grp[k].units+=(d.grouped_units||1);grp[k].val+=(d.delivery_value||0);grp[k].earn+=(d.delivery_fee||0);});const tb=document.getElementById('earnTbl'),ent=Object.values(grp);if(!ent.length){tb.innerHTML='<tr><td colspan="7" class="empty"><p>No data</p></td></tr>';return;}tb.innerHTML=ent.map(e=>`<tr><td style="font-weight:600">${e.name}</td><td><span class="dt-badge dt-${e.type}">${e.type}</span></td><td>${e.del}</td><td>${e.units}</td><td>R${e.val.toFixed(2)}</td><td style="font-weight:700;color:var(--primary-red)">R${e.earn.toFixed(2)}</td><td><span class="status s-active"><span class="dot"></span>Paid</span></td></tr>`).join('');}catch(e){console.error(e);}}

    // TRACKING
    async function loadTracking(){try{const{data}=await sb.from('drivers').select('*').eq('online_status','online').order('last_seen',{ascending:false});const c=document.getElementById('onlineList');if(!data?.length){c.innerHTML='<p style="color:var(--input-gray);text-align:center;padding:40px 0">No drivers online</p>';return;}c.innerHTML=data.map(d=>`<div style="display:flex;align-items:center;padding:12px;border-bottom:1px solid #F1F5F5;gap:10px"><span class="tbl-av" style="width:36px;height:36px;font-size:13px;flex-shrink:0">${(d.full_name||'?')[0].toUpperCase()}</span><div style="flex:1"><div style="font-size:13px;font-weight:600">${d.full_name}</div><div style="font-size:11px;color:var(--input-gray)">${d.vehicle_type||'N/A'} â€¢ ${d.residential_area||'Unknown'}</div></div><span class="on-dot on"></span></div>`).join('');}catch(e){console.error(e);}}

    // TEMP
    async function loadTemp(){try{const{data:act}=await sb.from('temporary_activation').select('*').limit(1).maybeSingle();const on=act?.is_active||false;document.getElementById('tempToggle').checked=on;document.getElementById('actStatus').textContent=on?'ACTIVE':'INACTIVE';document.getElementById('actStatus').style.color=on?'var(--success-green)':'var(--error-red)';const{data}=await sb.from('drivers').select('*').eq('driver_type','temporary').order('created_at',{ascending:false});const tb=document.getElementById('tempTbl');if(!data?.length){tb.innerHTML='<tr><td colspan="8" class="empty"><i class="fas fa-user-clock"></i><h3>No Temp Drivers</h3></td></tr>';return;}tb.innerHTML=data.map(d=>`<tr><td><span class="tbl-av">${(d.full_name||'?')[0].toUpperCase()}</span><span class="tbl-name">${d.full_name}</span></td><td>${d.phone||''}</td><td>${d.residential_area||'N/A'}</td><td><span class="status s-${d.status}"><span class="dot"></span>${d.status}</span></td><td><span class="on-dot ${d.online_status==='online'?'on':'off'}"></span>${d.online_status||'offline'}</td><td>${d.total_deliveries||0}</td><td>R${((d.total_deliveries||0)*50).toFixed(0)}</td><td>${d.status==='active'?`<button class="btn btn-sm btn-danger" onclick="suspend('${d.id}')"><i class="fas fa-ban"></i></button>`:`<button class="btn btn-sm btn-success" onclick="approve('${d.id}')"><i class="fas fa-check"></i></button>`}</td></tr>`).join('');}catch(e){console.error(e);}}
    async function toggleTemp(on){try{const{data:ex}=await sb.from('temporary_activation').select('id').limit(1).maybeSingle();if(ex){await sb.from('temporary_activation').update({is_active:on,activated_at:on?new Date().toISOString():null,updated_at:new Date().toISOString()}).eq('id',ex.id);}else{await sb.from('temporary_activation').insert({is_active:on,activated_at:on?new Date().toISOString():null});}document.getElementById('actStatus').textContent=on?'ACTIVE':'INACTIVE';document.getElementById('actStatus').style.color=on?'var(--success-green)':'var(--error-red)';toast(on?'success':'warning',on?'Temp hiring activated!':'Temp hiring deactivated');await bulkNotif(on?'temporary':'temporary',on?'activation':'activation',on?'Hiring Activated!':'Hiring Deactivated',on?'Go online to receive requests.':'Temp hiring deactivated.');}catch(e){toast('error',e.message);}}

    // NOTIFICATIONS
    async function sendNotif(e){e.preventDefault();const target=document.getElementById('nTarget').value,type=document.getElementById('nType').value,title=document.getElementById('nTitle').value,msg=document.getElementById('nMsg').value;await bulkNotif(target,type,title,msg);closeModal('notifModal');}
    async function bulkNotif(target,type,title,msg){try{let q=sb.from('drivers').select('id');if(target==='permanent')q=q.eq('driver_type','permanent');else if(target==='old')q=q.eq('driver_type','old');else if(target==='temporary')q=q.eq('driver_type','temporary');else if(target==='online')q=q.eq('online_status','online');const{data:drvs}=await q;if(!drvs?.length){toast('warning','No drivers for target');return;}const notifs=drvs.map(d=>({driver_id:d.id,type,title,message:msg,is_read:false}));await sb.from('notifications').insert(notifs);toast('success',`Sent to ${drvs.length} driver${drvs.length!==1?'s':''}`);}catch(e){toast('error',e.message);}}

    // HELPERS
    function openModal(id){document.getElementById(id).classList.add('show');}
    function closeModal(id){document.getElementById(id).classList.remove('show');}
    function toast(type,msg){const icons={success:'<i class="fas fa-check-circle" style="color:var(--success-green)"></i>',error:'<i class="fas fa-exclamation-circle" style="color:var(--error-red)"></i>',warning:'<i class="fas fa-exclamation-triangle" style="color:var(--warning-orange)"></i>',info:'<i class="fas fa-info-circle" style="color:var(--blue)"></i>'};const c=document.getElementById('toastBox'),t=document.createElement('div');t.className=`toast ${type}`;t.innerHTML=`${icons[type]||icons.info}<span class="toast-msg">${msg}</span><button class="toast-x" onclick="this.parentElement.remove()">&times;</button>`;c.appendChild(t);setTimeout(()=>{if(t.parentElement)t.remove();},5000);}

    calc();checkSess();
    </script>
</body>
</html>